<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Thi·ªáp Sinh Nh·∫≠t üéÇ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0f172a; --card:#0b1224; --text:#e5e7eb; --muted:#94a3b8;
      --primary:#6366f1; --primary-600:#4f46e5; --ok:#10b981; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; color:var(--text);
      font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;
      background: radial-gradient(1200px 600px at 10% -10%, #1e293b 0%, transparent 60%), var(--bg);
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    

    /* fireworks background */
    #fireworks{
      position:fixed; inset:0; z-index:-1; pointer-events:none;
      background: radial-gradient(1200px 600px at 110% 110%, #111827 0%, transparent 60%);
    }

    .btn{
      appearance:none; border:0; cursor:pointer; padding:12px 18px; border-radius:999px;
      font-weight:700; letter-spacing:.2px; transition:.2s; user-select:none;
      background:linear-gradient(135deg,var(--primary),var(--primary-600)); color:#fff; box-shadow:0 10px 24px #00000040;
    }
    .btn:hover{transform:translateY(-1px); box-shadow:0 14px 28px #00000055}
    .btn:active{transform:translateY(0); box-shadow:0 8px 18px #00000044}

    /* floating sound controls */
    .sound-toggle{
      position:fixed; right:16px; bottom:16px; z-index:40;
      display:flex; gap:10px; align-items:center;
    }
    .chip{
      background:#ffffff14; color:#fff; border:1px solid #ffffff22;
      padding:10px 14px; border-radius:999px; backdrop-filter: blur(8px);
      cursor:pointer; user-select:none; transition:.2s;
    }
    .chip:hover{background:#ffffff24}

    .nudge{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:84px; z-index:40; background:#111827; color:#fff;
      border:1px solid #ffffff22; padding:10px 16px; border-radius:12px;
      box-shadow:0 8px 24px #00000055; display:none;
    }
    .nudge.show{display:block}

    /* Modal */
    .modal{position:fixed; inset:0; display:none; place-items:center; z-index:50}
    .modal.open{display:grid}
    .backdrop{position:absolute; inset:0; background:#0006; backdrop-filter: blur(6px); animation:fadeIn .25s both}
    @keyframes fadeIn{from{opacity:0} to{opacity:1}}
    .dialog{
      position:relative; width:min(640px,92vw); border-radius:24px; overflow:hidden;
      background:linear-gradient(180deg, #0b1224 0%, #0b1224 30%, #0f172a 100%);
      border:1px solid #ffffff10; box-shadow:0 20px 60px #00000080;
      transform:translateY(20px) scale(.98); opacity:0; animation:pop .35s cubic-bezier(.2,.8,.2,1) .05s forwards;
    }
    @keyframes pop{to{transform:translateY(0) scale(1); opacity:1}}
    .dialog-header{
      padding:18px 22px; display:flex; align-items:center; justify-content:space-between;
      background: linear-gradient(180deg, #111827aa, #0b122400); border-bottom:1px solid #ffffff10;
    }
    .dialog-title{font-size:18px; font-weight:800; letter-spacing:.3px}
    .close{width:40px; height:40px; display:grid; place-items:center; border-radius:12px; cursor:pointer;
      color:#fff; background:#ffffff14; transition:.2s}
    .close:hover{background:#ffffff24; transform:rotate(5deg)}
    .dialog-body{position:relative; padding:22px; display:grid; gap:18px}

    .letter{
      position:relative; padding:22px; border-radius:16px; background: var(--card);
      border:1px solid #ffffff12; box-shadow: inset 0 0 0 1px #00000055, 0 8px 24px #00000055; overflow:hidden;
    }
    .letter::before{content:""; position:absolute; inset:-2px;
      background: conic-gradient(from 200deg, #ffffff07, transparent 30%, #ffffff05 60%, transparent 80%);
      filter: blur(8px); pointer-events:none;}
    .subtitle{color:var(--muted); margin-top:2px}
    .headline{font-size:28px; font-weight:900; margin:4px 0 8px}
    .message{line-height:1.6; color:#cbd5e1}

    .modal-actions{position:relative; margin-top:8px; padding-top:6px; display:flex; gap:12px; align-items:center; min-height:64px}
    .btn-yes{background:linear-gradient(135deg,var(--ok),#059669)}
    .btn-no{background:linear-gradient(135deg,var(--danger),#dc2626); position:relative; z-index:2}

    /* Confetti inside modal agree */
    #confetti{position:absolute; inset:0; pointer-events:none; z-index:3; opacity:0; transition:opacity .2s}
    #confetti.show{opacity:1}
  </style>
</head>
<body>

  <!-- Background fireworks -->
  <canvas id="fireworks"></canvas>

  <!-- Entry button -->
  <button id="openCardBtn" class="btn"><div>Sinh nh·∫≠t Vui v·∫ª üéÇ</div></button>

  <!-- Sound controls -->
  <div class="sound-toggle">
    <div id="toggleSound" class="chip" role="button" aria-label="B·∫≠t/T·∫Øt nh·∫°c">üîä T·∫Øt/B·∫≠t nh·∫°c</div>
  </div>
  <div id="soundNudge" class="nudge">Tr√¨nh duy·ªát ch·∫∑n t·ª± ph√°t nh·∫°c. B·∫•m ‚ÄúB·∫≠t nh·∫°c üîä‚Äù.</div>

  <!-- Hidden audio (replace mp3 path for your site) -->
 <audio id="bgm" src="https://cdn.your-domain.com/audio/happy-birthday.mp3" preload="auto" loop crossorigin="anonymous"></audio>

  <!-- Modal card -->
  <div id="bdayModal" class="modal" aria-hidden="true">
    <div class="backdrop" data-close></div>

    <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="bdayTitle">
      <canvas id="confetti"></canvas>

      <div class="dialog-header">
        <div class="dialog-title" id="bdayTitle">Happy birthday</div>
        <div class="close" role="button" aria-label="ƒê√≥ng (Esc)" data-close>‚úï</div>
      </div>

      <div class="dialog-body">
        <div class="letter">
          <div class="subtitle">Send Th√πy Linh,</div>
          <div class="headline">Ch√∫c m·ª´ng sinh nh·∫≠t üéâ</div>
          <div class="message">
  Tui bi·∫øt l√† g·∫ßn h·∫øt m·ªôt ng√†y d√†i r·ªìi m·ªõi g·ª≠i l·ªùi ch√∫c cho c·∫≠u. 
  V√¨ mu·ªën l·ªùi ch√∫c n√†y s·∫Ω l√† ƒëi·ªÅu cu·ªëi c√πng trong ng√†y ƒë·∫∑c bi·ªát h√¥m nay m√† c·∫≠u nh·ªõ ƒë·∫øn ‚ú®.<br><br>
  Mong tu·ªïi m·ªõi c·ªßa c·∫≠u th·∫≠t nhi·ªÅu ni·ªÅm vui v√† may m·∫Øn nha. 
  Ch√∫c c·∫≠u th√™m tu·ªïi m·ªõi th·∫≠t nhi·ªÅu s·ª©c kh·ªèe, ni·ªÅm vui v√† lu√¥n gi·ªØ n·ª• c∆∞·ªùi xinh tr√™n m√¥i.<br><br>
  Mong r·∫±ng m·ªçi d·ª± ƒë·ªãnh, ∆∞·ªõc m∆° c·ªßa c·∫≠u s·∫Ω d·∫ßn th√†nh hi·ªán th·ª±c, v√† m·ªói ng√†y tr√¥i qua ƒë·ªÅu ƒë√°ng nh·ªõ h∆°n ng√†y tr∆∞·ªõc. 
  Hy v·ªçng trong s·ªë nh·ªØng ƒëi·ªÅu c·∫≠u nh·ªõ v·ªÅ h√¥m nay‚Ä¶ c√≥ c·∫£ t·ªõ n·ªØa üíï.
</div>
        </div>

        <div class="modal-actions" id="actions">
          <button id="agreeBtn" class="btn btn-yes">ƒê·ªìng √Ω nh·∫≠n l·ªùi ch√∫c üíö</button>
          <button id="declineBtn" class="btn btn-no">Kh√¥ng ƒë·ªìng √Ω</button>
          <span class="hint" style="font-size:12px;color:#94a3b8">* H√¨nh nh∆∞ kh√¥ng th·ªÉ t·ª´ ch·ªëi ƒë∆∞·ª£c ƒë√¢u üòú</span>
        </div>
      </div>
    </div>
  </div>

<script>
/* ========= Audio: autoplay with graceful fallback ========= */
const bgm = document.getElementById('bgm');
const toggleSound = document.getElementById('toggleSound');
const soundNudge = document.getElementById('soundNudge');

bgm.volume = 0.65;

async function tryPlayBgm() {
  try {
    await bgm.play();
    soundNudge.classList.remove('show');
  } catch (e) {
    // Autoplay likely blocked
    soundNudge.classList.add('show');
  }
}
document.addEventListener('DOMContentLoaded', tryPlayBgm);
// Unlock on any user gesture
['click','touchstart','keydown'].forEach(evt=>{
  window.addEventListener(evt,()=>{ if(bgm.paused) tryPlayBgm(); }, { once:false });
});

toggleSound.addEventListener('click', ()=>{
  if (bgm.paused){ bgm.play(); soundNudge.classList.remove('show'); }
  else bgm.pause();
  toggleSound.textContent = bgm.paused ? 'üîá B·∫≠t nh·∫°c' : 'üîä T·∫Øt nh·∫°c';
});

/* ================= Fireworks background =================== */
(() => {
  const canvas = document.getElementById('fireworks');
  const ctx = canvas.getContext('2d', { alpha: true });
  let w, h, dpr = Math.min(window.devicePixelRatio || 1, 2);
  let rockets = [], particles = [];
  const GRAVITY = 0.06, AIR = 0.995;
  const MAX_ROCKETS = 5, MAX_PARTICLES = 350;

  function resize(){
    w = canvas.clientWidth = window.innerWidth;
    h = canvas.clientHeight = window.innerHeight;
    canvas.width = Math.floor(w * dpr);
    canvas.height = Math.floor(h * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  window.addEventListener('resize', resize, { passive:true }); resize();

  function rand(min, max){ return Math.random()*(max-min)+min; }

  function launch(){
    if (rockets.length >= MAX_ROCKETS) return;
    const x = rand(w*0.1, w*0.9);
    const y = h + 10;
    const targetX = rand(w*0.2, w*0.8);
    const targetY = rand(h*0.15, h*0.4);
    const speed = rand(6.5, 8.5);
    const angle = Math.atan2(targetY - y, targetX - x);
    rockets.push({
      x, y, vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed,
      color: `hsl(${Math.floor(rand(0,360))} 90% 60%)`,
      targetY,
      life: rand(50, 80)
    });
  }

  function explode(x,y,color){
    const count = Math.floor(rand(40, 70));
    for(let i=0;i<count;i++){
      const angle = Math.random()*Math.PI*2;
      const speed = rand(1.5, 4.2) * (0.9 + Math.random()*0.3);
      particles.push({
        x, y,
        vx: Math.cos(angle)*speed,
        vy: Math.sin(angle)*speed,
        alpha: 1,
        size: rand(1.5,3.2),
        color,
        life: rand(45, 90)
      });
    }
  }

  let last = 0;
  function step(ts){
    requestAnimationFrame(step);
    // throttle launch
    if(ts - last > 500 + Math.random()*600){ launch(); last = ts; }

    // fade trail
    ctx.globalCompositeOperation = 'destination-out';
    ctx.fillStyle = 'rgba(0,0,0,0.25)';
    ctx.fillRect(0,0,w,h);
    ctx.globalCompositeOperation = 'lighter';

    // update rockets
    for(let i=rockets.length-1;i>=0;i--){
      const r = rockets[i];
      r.x += r.vx; r.y += r.vy;
      r.vy += GRAVITY*0.25;
      r.life--;

      // draw rocket
      ctx.beginPath(); ctx.arc(r.x, r.y, 2.2, 0, Math.PI*2);
      ctx.fillStyle = r.color; ctx.fill();

      // sparkle tail
      ctx.beginPath();
      ctx.moveTo(r.x, r.y);
      ctx.lineTo(r.x - r.vx*2, r.y - r.vy*2);
      ctx.strokeStyle = r.color; ctx.lineWidth = 1; ctx.stroke();

      if(r.vy >= 0 || r.y <= r.targetY || r.life <= 0){
        explode(r.x, r.y, r.color);
        rockets.splice(i,1);
      }
    }

    // limit particles for perf
    if(particles.length > MAX_PARTICLES) particles.splice(0, particles.length - MAX_PARTICLES);

    // update particles
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.vx *= AIR; p.vy = p.vy*AIR + GRAVITY;
      p.x += p.vx; p.y += p.vy;
      p.life--; p.alpha = Math.max(0, p.life/90);

      ctx.globalAlpha = p.alpha;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
      ctx.fillStyle = p.color;
      ctx.fill();
      ctx.globalAlpha = 1;

      if(p.alpha <= 0 || p.y > h+10) particles.splice(i,1);
    }
  }
  requestAnimationFrame(step);
})();

/* ================= Modal + Evasive decline ================= */
const openBtn   = document.getElementById('openCardBtn');
const modal     = document.getElementById('bdayModal');
const backdrop  = modal.querySelector('.backdrop');
const closeEls  = modal.querySelectorAll('[data-close]');
const agreeBtn  = document.getElementById('agreeBtn');
const declineBtn= document.getElementById('declineBtn');
const actions   = document.getElementById('actions');
const confettiC = document.getElementById('confetti');
let lastFocused = null;

function openModal(){
  lastFocused = document.activeElement;
  modal.classList.add('open');
  modal.setAttribute('aria-hidden','false');
  setTimeout(()=>agreeBtn.focus(), 50);
  makeDeclineEvasive();
  resizeConfetti();
}
function closeModal(){
  modal.classList.remove('open');
  modal.setAttribute('aria-hidden','true');
  if(lastFocused) lastFocused.focus();
  stopConfetti();
}
openBtn.addEventListener('click', openModal);
backdrop.addEventListener('click', closeModal);
closeEls.forEach(el=>el.addEventListener('click', closeModal));
window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && modal.classList.contains('open')) closeModal(); });

function makeDeclineEvasive(){
  declineBtn.style.position = 'absolute';
  const dodge = ()=>{
    const area = actions.getBoundingClientRect();
    const btn  = declineBtn.getBoundingClientRect();
    const maxX = Math.max(0, area.width - btn.width  - 6);
    const maxY = Math.max(0, area.height- btn.height - 6);
    const x = Math.random()*maxX, y = Math.random()*maxY;
    declineBtn.style.transition = 'transform .15s ease';
    declineBtn.style.transform = `translate(${x}px, ${y}px)`;
  };
  declineBtn.addEventListener('mouseenter', dodge);
  declineBtn.addEventListener('mousemove', dodge);
  actions.addEventListener('mousemove', (e)=>{
    const b = declineBtn.getBoundingClientRect();
    const near = (dx,dy)=> Math.hypot(dx,dy) < 60;
    const dx = e.clientX - (b.left + b.width/2);
    const dy = e.clientY - (b.top  + b.height/2);
    if(near(dx,dy)) dodge();
  });
  const block=(e)=>{ e.preventDefault(); e.stopPropagation(); declineBtn.blur(); };
  declineBtn.addEventListener('click', block);
  declineBtn.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' ') block(e); });
}

/* ================= Confetti on Agree ================= */
let rafId = null, particlesCF = [];
function resizeConfetti(){
  const d = modal.querySelector('.dialog').getBoundingClientRect();
  confettiC.width = Math.floor(d.width);
  confettiC.height= Math.floor(d.height);
}
window.addEventListener('resize', ()=>{ if(modal.classList.contains('open')) resizeConfetti(); });

agreeBtn.addEventListener('click', ()=>{
  celebrate();
  const msg = modal.querySelector('.message');
  msg.innerHTML = 'C·∫£m ∆°n b·∫°n ƒë√£ nh·∫≠n l·ªùi ch√∫c! Ch√∫c m·ªôt nƒÉm b√πng n·ªï nƒÉng l∆∞·ª£ng, h·∫°nh ph√∫c ng·∫≠p tr√†n v√† th·∫≠t nhi·ªÅu ƒëi·ªÅu b·∫•t ng·ªù t·ªët ƒë·∫πp! üíñüéâ';
  agreeBtn.disabled = true; agreeBtn.textContent = 'ƒê√£ nh·∫≠n üéÅ';
  setTimeout(()=>{ agreeBtn.disabled = false; }, 2200);
});

function celebrate(){
  resizeConfetti();
  const ctx = confettiC.getContext('2d');
  confettiC.classList.add('show');
  const colors = ['#f87171','#fb923c','#fbbf24','#34d399','#60a5fa','#a78bfa','#f472b6'];
  const N = 120;
  particlesCF = Array.from({length:N}, ()=>({
    x: confettiC.width * Math.random(),
    y: -20 - Math.random()*40,
    vx: (Math.random()-0.5)*2.2,
    vy: 2 + Math.random()*2.5,
    size: 6 + Math.random()*6,
    rot: Math.random()*Math.PI,
    vr: (Math.random()-0.5)*0.2,
    color: colors[Math.floor(Math.random()*colors.length)],
    shape: Math.random() < .6 ? 'rect' : 'circle',
    life: 120 + Math.random()*60
  }));

  function step(){
    ctx.clearRect(0,0,confettiC.width,confettiC.height);
    particlesCF.forEach(p=>{
      p.x += p.vx; p.y += p.vy; p.rot += p.vr; p.vy += 0.02; p.life -= 1;
      if(p.y > confettiC.height + 20 || p.life <= 0) {
        p.x = confettiC.width * Math.random();
        p.y = -20 - Math.random()*40;
        p.vx= (Math.random()-0.5)*2.2;
        p.vy= 2 + Math.random()*2.5;
        p.life = 120 + Math.random()*60;
      }
      ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot);
      ctx.fillStyle = p.color;
      if(p.shape==='rect'){ ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.6); }
      else { ctx.beginPath(); ctx.arc(0,0,p.size/2,0,Math.PI*2); ctx.fill(); }
      ctx.restore();
    });
    rafId = requestAnimationFrame(step);
  }
  cancelAnimationFrame(rafId); step();
  setTimeout(stopConfetti, 2500);
}
function stopConfetti(){
  if(rafId) cancelAnimationFrame(rafId);
  confettiC.classList.remove('show');
  const ctx = confettiC.getContext('2d'); if(ctx) ctx.clearRect(0,0,confettiC.width, confettiC.height);
}
</script>
</body>
</html>
